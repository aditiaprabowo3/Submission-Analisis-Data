import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import os

# Dapatkan path absolut ke file all_data.csv
file_path = os.path.join(os.path.dirname(__file__), "main_data.csv")

# Baca file CSV
hr_df = pd.read_csv(file_path)

hr_df['dteday'] = pd.to_datetime(hr_df['dteday'])

# Judul Dashboard
st.title("Analisis Penyewaan Sepeda")

weather_mapping = {
    1: "Cerah",
    2: "Mendung",
    3: "Hujan Ringan",
    4: "Hujan Lebat"
}
hr_df['weather_desc'] = hr_df['weathersit'].map(weather_mapping)

month_mapping = {
    1: "Januari", 2: "Februari", 3: "Maret", 4: "April",
    5: "Mei", 6: "Juni", 7: "Juli", 8: "Agustus",
    9: "September", 10: "Oktober", 11: "November", 12: "Desember"
}
hr_df['month_name'] = hr_df['mnth'].map(month_mapping)

# Kelompokkan data berdasarkan tanggal
daily_rental = hr_df.groupby('dteday').agg({
    'casual': 'sum',
    'registered': 'sum',
    'cnt': 'sum'
}).reset_index()

# Ambil total keseluruhan
total_casual = daily_rental['casual'].sum()
total_registered = daily_rental['registered'].sum()
total_users = daily_rental['cnt'].sum()

st.header("Daily Rentals")
col1, col2, col3 = st.columns(3)
col1.metric("Casual User", f"{total_casual:,}")
col2.metric("Registered User", f"{total_registered:,}")
col3.metric("Total User", f"{total_users:,}")

# sidebar
with st.sidebar:
    st.sidebar.markdown(
        """
        <svg xmlns="http://www.w3.org/2000/svg" width="105" height="60" viewBox="0 0 105 60" fill="none">
            <path d="M17.5318 28.6163V33.7446C17.5318 36.3088 16.4036 37.2319 14.6086 37.2319C12.8137 37.2319 11.6855 36.3088 11.6855 33.7446V14.3596C11.6855 11.7955 12.8137 10.8211 14.6086 10.8211C16.4036 10.8211 17.5318 11.7955 17.5318 14.3596V18.2059H22.8652V14.7186C22.8652 8.97491 19.9934 5.69279 14.4548 5.69279C8.91622 5.69279 6.04437 8.97491 6.04437 14.7186V33.3857C6.04437 39.1294 8.91622 42.4115 14.4548 42.4115C19.9934 42.4115 22.8652 39.1294 22.8652 33.3857V28.6163H17.5318ZM31.0192 42.0012H36.6604V30.1035L43.7887 6.10305H38.404L34.0962 22.4624L29.7884 6.10305H23.8909L31.0192 30.1035V42.0012ZM56.3447 28.6163V33.7446C56.3447 36.3088 55.2164 37.2319 53.4215 37.2319C51.6266 37.2319 50.4984 36.3088 50.4984 33.7446V14.3596C50.4984 11.7955 51.6266 10.8211 53.4215 10.8211C55.2164 10.8211 56.3447 11.7955 56.3447 14.3596V18.2059H61.6781V14.7186C61.6781 8.97491 58.8063 5.69279 53.2677 5.69279C47.7291 5.69279 44.8573 8.97491 44.8573 14.7186V33.3857C44.8573 39.1294 47.7291 42.4115 53.2677 42.4115C58.8063 42.4115 61.6781 39.1294 61.6781 33.3857V28.6163H56.3447ZM65.1009 42.0012H80.0242V36.8729H70.742V6.10305H65.1009V42.0012ZM87.6586 14.3596C87.6586 11.7955 88.7868 10.8211 90.5817 10.8211C92.3766 10.8211 93.5049 11.7955 93.5049 14.3596V33.7446C93.5049 36.3088 92.3766 37.2832 90.5817 37.2832C88.7868 37.2832 87.6586 36.3088 87.6586 33.7446V14.3596ZM82.0175 33.3857C82.0175 39.1294 85.0432 42.4115 90.5817 42.4115C96.1203 42.4115 99.146 39.1294 99.146 33.3857V14.7186C99.146 8.97491 96.1203 5.69279 90.5817 5.69279C85.0432 5.69279 82.0175 8.97491 82.0175 14.7186V33.3857Z" fill="#4ABAFF"/>
            <path d="M6.79025 55.0856L5.52772 52.8919H4.84122V55.0856H3.94166V49.6015H5.83546C6.2563 49.6015 6.61139 49.6751 6.90072 49.8224C7.19531 49.9697 7.41362 50.167 7.55566 50.4142C7.70295 50.6615 7.7766 50.9376 7.7766 51.2427C7.7766 51.6005 7.67139 51.9266 7.46097 52.2212C7.2558 52.5105 6.93754 52.7078 6.50618 52.813L7.8634 55.0856H6.79025ZM4.84122 52.1739H5.83546C6.17213 52.1739 6.42464 52.0897 6.59298 51.9214C6.76657 51.753 6.85337 51.5268 6.85337 51.2427C6.85337 50.9587 6.7692 50.7377 6.60087 50.5799C6.43253 50.4168 6.17739 50.3353 5.83546 50.3353H4.84122V52.1739ZM12.9122 52.8051C12.9122 52.9682 12.9017 53.1155 12.8807 53.247H9.55863C9.58493 53.5942 9.71381 53.873 9.94528 54.0834C10.1767 54.2939 10.4608 54.3991 10.7975 54.3991C11.2815 54.3991 11.6234 54.1965 11.8233 53.7915H12.7939C12.6623 54.1913 12.423 54.5201 12.0758 54.7778C11.7339 55.0303 11.3078 55.1566 10.7975 55.1566C10.3819 55.1566 10.0084 55.0645 9.67699 54.8804C9.35083 54.691 9.09307 54.428 8.90369 54.0913C8.71957 53.7494 8.62751 53.3549 8.62751 52.9077C8.62751 52.4606 8.71694 52.0687 8.8958 51.732C9.07992 51.39 9.33505 51.127 9.66121 50.9429C9.99262 50.7588 10.3714 50.6667 10.7975 50.6667C11.2078 50.6667 11.5734 50.7561 11.8943 50.935C12.2152 51.1139 12.4651 51.3664 12.6439 51.6925C12.8228 52.0134 12.9122 52.3843 12.9122 52.8051ZM11.9732 52.5211C11.968 52.1896 11.8496 51.924 11.6181 51.7241C11.3867 51.5242 11.1 51.4242 10.758 51.4242C10.4477 51.4242 10.182 51.5242 9.96106 51.7241C9.74011 51.9187 9.6086 52.1844 9.56652 52.5211H11.9732ZM15.9911 50.6667C16.3331 50.6667 16.6382 50.7377 16.9064 50.8798C17.18 51.0218 17.393 51.2322 17.5456 51.511C17.6982 51.7898 17.7744 52.1265 17.7744 52.5211V55.0856H16.8828V52.6552C16.8828 52.2659 16.7855 51.9687 16.5908 51.7635C16.3962 51.5531 16.1305 51.4479 15.7938 51.4479C15.4572 51.4479 15.1889 51.5531 14.989 51.7635C14.7943 51.9687 14.697 52.2659 14.697 52.6552V55.0856H13.7975V50.7377H14.697V51.2349C14.8443 51.056 15.0311 50.9166 15.2573 50.8166C15.4887 50.7167 15.7333 50.6667 15.9911 50.6667ZM19.9714 51.4716V53.8783C19.9714 54.0414 20.0082 54.1597 20.0818 54.2334C20.1607 54.3018 20.2922 54.3359 20.4764 54.3359H21.0287V55.0856H20.3185C19.9135 55.0856 19.6031 54.9909 19.3874 54.8015C19.1717 54.6121 19.0639 54.3044 19.0639 53.8783V51.4716H18.551V50.7377H19.0639V49.6567H19.9714V50.7377H21.0287V51.4716H19.9714ZM21.558 52.8919C21.558 52.4553 21.6474 52.0687 21.8262 51.732C22.0104 51.3953 22.2576 51.1349 22.568 50.9508C22.8836 50.7614 23.2308 50.6667 23.6096 50.6667C23.9515 50.6667 24.2487 50.7351 24.5012 50.8719C24.759 51.0034 24.9642 51.1691 25.1167 51.369V50.7377H26.0242V55.0856H25.1167V54.4385C24.9642 54.6437 24.7564 54.8147 24.4933 54.9514C24.2303 55.0882 23.9305 55.1566 23.5938 55.1566C23.2203 55.1566 22.8784 55.0619 22.568 54.8725C22.2576 54.6779 22.0104 54.4096 21.8262 54.0677C21.6474 53.7205 21.558 53.3286 21.558 52.8919ZM25.1167 52.9077C25.1167 52.6079 25.0536 52.3475 24.9273 52.1265C24.8063 51.9056 24.6459 51.7372 24.446 51.6215C24.2461 51.5058 24.0304 51.4479 23.7989 51.4479C23.5675 51.4479 23.3518 51.5058 23.1519 51.6215C22.952 51.732 22.7889 51.8977 22.6627 52.1186C22.5417 52.3343 22.4812 52.5921 22.4812 52.8919C22.4812 53.1918 22.5417 53.4548 22.6627 53.681C22.7889 53.9072 22.952 54.0808 23.1519 54.2018C23.3571 54.3175 23.5727 54.3754 23.7989 54.3754C24.0304 54.3754 24.2461 54.3175 24.446 54.2018C24.6459 54.0861 24.8063 53.9177 24.9273 53.6968C25.0536 53.4706 25.1167 53.2076 25.1167 52.9077ZM28.1052 49.2464V55.0856H27.2057V49.2464H28.1052ZM32.2356 51.3848C32.3881 51.1744 32.5959 51.0034 32.859 50.8719C33.1272 50.7351 33.4245 50.6667 33.7506 50.6667C34.1346 50.6667 34.4818 50.7588 34.7922 50.9429C35.1026 51.127 35.3472 51.39 35.526 51.732C35.7049 52.0687 35.7943 52.4553 35.7943 52.8919C35.7943 53.3286 35.7049 53.7205 35.526 54.0677C35.3472 54.4096 35.0999 54.6779 34.7843 54.8725C34.4739 55.0619 34.1294 55.1566 33.7506 55.1566C33.4139 55.1566 33.1141 55.0908 32.8511 54.9593C32.5933 54.8278 32.3881 54.6595 32.2356 54.4543V55.0856H31.336V49.2464H32.2356V51.3848ZM34.879 52.8919C34.879 52.5921 34.8159 52.3343 34.6896 52.1186C34.5686 51.8977 34.4056 51.732 34.2004 51.6215C34.0005 51.5058 33.7848 51.4479 33.5533 51.4479C33.3271 51.4479 33.1115 51.5058 32.9063 51.6215C32.7064 51.7372 32.5433 51.9056 32.4171 52.1265C32.2961 52.3475 32.2356 52.6079 32.2356 52.9077C32.2356 53.2076 32.2961 53.4706 32.4171 53.6968C32.5433 53.9177 32.7064 54.0861 32.9063 54.2018C33.1115 54.3175 33.3271 54.3754 33.5533 54.3754C33.7848 54.3754 34.0005 54.3175 34.2004 54.2018C34.4056 54.0808 34.5686 53.9072 34.6896 53.681C34.8159 53.4548 34.879 53.1918 34.879 52.8919ZM37.1416 50.1617C36.9785 50.1617 36.8417 50.1065 36.7312 49.996C36.6208 49.8855 36.5655 49.7488 36.5655 49.5857C36.5655 49.4226 36.6208 49.2858 36.7312 49.1754C36.8417 49.0649 36.9785 49.0096 37.1416 49.0096C37.2994 49.0096 37.4335 49.0649 37.544 49.1754C37.6545 49.2858 37.7097 49.4226 37.7097 49.5857C37.7097 49.7488 37.6545 49.8855 37.544 49.996C37.4335 50.1065 37.2994 50.1617 37.1416 50.1617ZM37.5835 50.7377V55.0856H36.6839V50.7377H37.5835ZM40.4847 52.9156L42.4889 55.0856H41.2738L39.664 53.2154V55.0856H38.7645V49.2464H39.664V52.6394L41.2422 50.7377H42.4889L40.4847 52.9156ZM47.1186 52.8051C47.1186 52.9682 47.108 53.1155 47.087 53.247H43.765C43.7913 53.5942 43.9202 53.873 44.1516 54.0834C44.3831 54.2939 44.6672 54.3991 45.0038 54.3991C45.4878 54.3991 45.8297 54.1965 46.0296 53.7915H47.0002C46.8687 54.1913 46.6293 54.5201 46.2821 54.7778C45.9402 55.0303 45.5141 55.1566 45.0038 55.1566C44.5883 55.1566 44.2148 55.0645 43.8833 54.8804C43.5572 54.691 43.2994 54.428 43.11 54.0913C42.9259 53.7494 42.8339 53.3549 42.8339 52.9077C42.8339 52.4606 42.9233 52.0687 43.1021 51.732C43.2863 51.39 43.5414 51.127 43.8676 50.9429C44.199 50.7588 44.5777 50.6667 45.0038 50.6667C45.4142 50.6667 45.7798 50.7561 46.1007 50.935C46.4215 51.1139 46.6714 51.3664 46.8503 51.6925C47.0291 52.0134 47.1186 52.3843 47.1186 52.8051ZM46.1796 52.5211C46.1743 52.1896 46.0559 51.924 45.8245 51.7241C45.593 51.5242 45.3063 51.4242 44.9644 51.4242C44.654 51.4242 44.3884 51.5242 44.1674 51.7241C43.9465 51.9187 43.815 52.1844 43.7729 52.5211H46.1796ZM49.582 55.1566C49.24 55.1566 48.9323 55.0961 48.6588 54.9751C48.3905 54.8488 48.1774 54.6805 48.0196 54.4701C47.8618 54.2544 47.7776 54.0151 47.7671 53.752H48.6982C48.714 53.9361 48.8008 54.0913 48.9586 54.2176C49.1217 54.3386 49.3242 54.3991 49.5662 54.3991C49.8187 54.3991 50.0133 54.3517 50.1501 54.257C50.2922 54.1571 50.3632 54.0308 50.3632 53.8783C50.3632 53.7152 50.2843 53.5942 50.1264 53.5153C49.9739 53.4364 49.7293 53.3496 49.3926 53.2549C49.0665 53.1655 48.8008 53.0787 48.5956 52.9945C48.3905 52.9103 48.2116 52.7815 48.0591 52.6079C47.9118 52.4343 47.8381 52.2054 47.8381 51.9214C47.8381 51.6899 47.9065 51.4795 48.0433 51.2901C48.18 51.0955 48.3747 50.9429 48.6272 50.8324C48.885 50.722 49.1796 50.6667 49.511 50.6667C50.0055 50.6667 50.4026 50.793 50.7025 51.0455C51.0076 51.2927 51.1707 51.632 51.1917 52.0634H50.2922C50.2764 51.8688 50.1975 51.7136 50.0554 51.5978C49.9134 51.4821 49.7214 51.4242 49.4794 51.4242C49.2427 51.4242 49.0612 51.469 48.9349 51.5584C48.8087 51.6478 48.7456 51.7662 48.7456 51.9135C48.7456 52.0292 48.7876 52.1265 48.8718 52.2054C48.956 52.2843 49.0586 52.3475 49.1796 52.3948C49.3005 52.4369 49.4794 52.4921 49.7161 52.5605C50.0318 52.6447 50.2895 52.7315 50.4894 52.8209C50.6946 52.9051 50.8708 53.0313 51.0181 53.1997C51.1654 53.368 51.2417 53.5916 51.2469 53.8704C51.2469 54.1176 51.1786 54.3386 51.0418 54.5332C50.905 54.7279 50.7104 54.8804 50.4579 54.9909C50.2106 55.1014 49.9187 55.1566 49.582 55.1566ZM56.0915 51.4716H55.2866V55.0856H54.3792V51.4716H53.8663V50.7377H54.3792V50.43C54.3792 49.9302 54.5107 49.5673 54.7737 49.3411C55.042 49.1096 55.4602 48.9939 56.0283 48.9939V49.7435C55.7548 49.7435 55.5628 49.7961 55.4523 49.9013C55.3418 50.0013 55.2866 50.1775 55.2866 50.43V50.7377H56.0915V51.4716ZM58.7746 55.1566C58.3643 55.1566 57.9934 55.0645 57.662 54.8804C57.3306 54.691 57.0702 54.428 56.8808 54.0913C56.6914 53.7494 56.5967 53.3549 56.5967 52.9077C56.5967 52.4658 56.694 52.0739 56.8887 51.732C57.0833 51.39 57.349 51.127 57.6857 50.9429C58.0223 50.7588 58.3985 50.6667 58.814 50.6667C59.2296 50.6667 59.6058 50.7588 59.9424 50.9429C60.2791 51.127 60.5448 51.39 60.7394 51.732C60.934 52.0739 61.0314 52.4658 61.0314 52.9077C61.0314 53.3496 60.9314 53.7415 60.7315 54.0834C60.5316 54.4254 60.2581 54.691 59.9109 54.8804C59.5689 55.0645 59.1902 55.1566 58.7746 55.1566ZM58.7746 54.3754C59.0061 54.3754 59.2217 54.3202 59.4216 54.2097C59.6268 54.0992 59.7925 53.9335 59.9188 53.7126C60.045 53.4916 60.1081 53.2233 60.1081 52.9077C60.1081 52.5921 60.0476 52.3264 59.9267 52.1107C59.8057 51.8898 59.6452 51.7241 59.4453 51.6136C59.2454 51.5031 59.0297 51.4479 58.7983 51.4479C58.5668 51.4479 58.3511 51.5031 58.1512 51.6136C57.9566 51.7241 57.8014 51.8898 57.6857 52.1107C57.5699 52.3264 57.5121 52.5921 57.5121 52.9077C57.5121 53.3759 57.6304 53.7389 57.8672 53.9966C58.1091 54.2491 58.4116 54.3754 58.7746 54.3754ZM62.8202 51.369C62.9517 51.1481 63.1253 50.9771 63.341 50.8561C63.5619 50.7298 63.8223 50.6667 64.1222 50.6667V51.5978H63.8933C63.5409 51.5978 63.2726 51.6873 63.0885 51.8661C62.9096 52.045 62.8202 52.3554 62.8202 52.7972V55.0856H61.9206V50.7377H62.8202V51.369ZM70.9836 52.8051C70.9836 52.9682 70.9731 53.1155 70.9521 53.247H67.6301C67.6564 53.5942 67.7852 53.873 68.0167 54.0834C68.2482 54.2939 68.5322 54.3991 68.8689 54.3991C69.3529 54.3991 69.6948 54.1965 69.8947 53.7915H70.8653C70.7338 54.1913 70.4944 54.5201 70.1472 54.7778C69.8053 55.0303 69.3792 55.1566 68.8689 55.1566C68.4533 55.1566 68.0798 55.0645 67.7484 54.8804C67.4223 54.691 67.1645 54.428 66.9751 54.0913C66.791 53.7494 66.6989 53.3549 66.6989 52.9077C66.6989 52.4606 66.7884 52.0687 66.9672 51.732C67.1513 51.39 67.4065 51.127 67.7326 50.9429C68.064 50.7588 68.4428 50.6667 68.8689 50.6667C69.2792 50.6667 69.6448 50.7561 69.9657 50.935C70.2866 51.1139 70.5365 51.3664 70.7154 51.6925C70.8942 52.0134 70.9836 52.3843 70.9836 52.8051ZM70.0446 52.5211C70.0394 52.1896 69.921 51.924 69.6896 51.7241C69.4581 51.5242 69.1714 51.4242 68.8295 51.4242C68.5191 51.4242 68.2534 51.5242 68.0325 51.7241C67.8115 51.9187 67.68 52.1844 67.6379 52.5211H70.0446ZM73.5496 54.2807L74.7806 50.7377H75.7354L74.0783 55.0856H73.0052L71.356 50.7377H72.3187L73.5496 54.2807ZM80.4002 52.8051C80.4002 52.9682 80.3897 53.1155 80.3687 53.247H77.0466C77.0729 53.5942 77.2018 53.873 77.4333 54.0834C77.6647 54.2939 77.9488 54.3991 78.2855 54.3991C78.7694 54.3991 79.1114 54.1965 79.3113 53.7915H80.2819C80.1503 54.1913 79.911 54.5201 79.5638 54.7778C79.2219 55.0303 78.7958 55.1566 78.2855 55.1566C77.8699 55.1566 77.4964 55.0645 77.165 54.8804C76.8388 54.691 76.5811 54.428 76.3917 54.0913C76.2076 53.7494 76.1155 53.3549 76.1155 52.9077C76.1155 52.4606 76.2049 52.0687 76.3838 51.732C76.5679 51.39 76.823 51.127 77.1492 50.9429C77.4806 50.7588 77.8594 50.6667 78.2855 50.6667C78.6958 50.6667 79.0614 50.7561 79.3823 50.935C79.7032 51.1139 79.9531 51.3664 80.1319 51.6925C80.3108 52.0134 80.4002 52.3843 80.4002 52.8051ZM79.4612 52.5211C79.456 52.1896 79.3376 51.924 79.1061 51.7241C78.8747 51.5242 78.588 51.4242 78.246 51.4242C77.9357 51.4242 77.67 51.5242 77.4491 51.7241C77.2281 51.9187 77.0966 52.1844 77.0545 52.5211H79.4612ZM82.185 51.369C82.3165 51.1481 82.4901 50.9771 82.7058 50.8561C82.9268 50.7298 83.1872 50.6667 83.487 50.6667V51.5978H83.2582C82.9057 51.5978 82.6374 51.6873 82.4533 51.8661C82.2744 52.045 82.185 52.3554 82.185 52.7972V55.0856H81.2855V50.7377H82.185V51.369ZM88.2277 50.7377L85.5606 57.1293H84.6295L85.5133 55.0146L83.801 50.7377H84.8031L86.0262 54.0519L87.2966 50.7377H88.2277ZM90.7925 55.1566C90.3822 55.1566 90.0113 55.0645 89.6799 54.8804C89.3485 54.691 89.0881 54.428 88.8987 54.0913C88.7093 53.7494 88.6146 53.3549 88.6146 52.9077C88.6146 52.4658 88.7119 52.0739 88.9066 51.732C89.1012 51.39 89.3669 51.127 89.7035 50.9429C90.0402 50.7588 90.4163 50.6667 90.8319 50.6667C91.2475 50.6667 91.6236 50.7588 91.9603 50.9429C92.297 51.127 92.5626 51.39 92.7573 51.732C92.9519 52.0739 93.0492 52.4658 93.0492 52.9077C93.0492 53.3496 92.9493 53.7415 92.7494 54.0834C92.5495 54.4254 92.2759 54.691 91.9287 54.8804C91.5868 55.0645 91.2081 55.1566 90.7925 55.1566ZM90.7925 54.3754C91.0239 54.3754 91.2396 54.3202 91.4395 54.2097C91.6447 54.0992 91.8104 53.9335 91.9366 53.7126C92.0629 53.4916 92.126 53.2233 92.126 52.9077C92.126 52.5921 92.0655 52.3264 91.9445 52.1107C91.8235 51.8898 91.6631 51.7241 91.4632 51.6136C91.2633 51.5031 91.0476 51.4479 90.8161 51.4479C90.5847 51.4479 90.369 51.5031 90.1691 51.6136C89.9745 51.7241 89.8193 51.8898 89.7035 52.1107C89.5878 52.3264 89.5299 52.5921 89.5299 52.9077C89.5299 53.3759 89.6483 53.7389 89.885 53.9966C90.127 54.2491 90.4295 54.3754 90.7925 54.3754ZM96.1322 50.6667C96.4741 50.6667 96.7792 50.7377 97.0475 50.8798C97.321 51.0218 97.5341 51.2322 97.6866 51.511C97.8392 51.7898 97.9155 52.1265 97.9155 52.5211V55.0856H97.0238V52.6552C97.0238 52.2659 96.9265 51.9687 96.7319 51.7635C96.5372 51.5531 96.2716 51.4479 95.9349 51.4479C95.5982 51.4479 95.3299 51.5531 95.13 51.7635C94.9354 51.9687 94.8381 52.2659 94.8381 52.6552V55.0856H93.9385V50.7377H94.8381V51.2349C94.9854 51.056 95.1721 50.9166 95.3983 50.8166C95.6298 50.7167 95.8744 50.6667 96.1322 50.6667ZM103.048 52.8051C103.048 52.9682 103.037 53.1155 103.016 53.247H99.6942C99.7205 53.5942 99.8494 53.873 100.081 54.0834C100.312 54.2939 100.596 54.3991 100.933 54.3991C101.417 54.3991 101.759 54.1965 101.959 53.7915H102.929C102.798 54.1913 102.559 54.5201 102.211 54.7778C101.869 55.0303 101.443 55.1566 100.933 55.1566C100.517 55.1566 100.144 55.0645 99.8125 54.8804C99.4864 54.691 99.2286 54.428 99.0392 54.0913C98.8551 53.7494 98.7631 53.3549 98.7631 52.9077C98.7631 52.4606 98.8525 52.0687 99.0313 51.732C99.2155 51.39 99.4706 51.127 99.7968 50.9429C100.128 50.7588 100.507 50.6667 100.933 50.6667C101.343 50.6667 101.709 50.7561 102.03 50.935C102.351 51.1139 102.601 51.3664 102.779 51.6925C102.958 52.0134 103.048 52.3843 103.048 52.8051ZM102.109 52.5211C102.104 52.1896 101.985 51.924 101.754 51.7241C101.522 51.5242 101.236 51.4242 100.894 51.4242C100.583 51.4242 100.318 51.5242 100.097 51.7241C99.8757 51.9187 99.7442 52.1844 99.7021 52.5211H102.109Z" fill="#68C5FF"/>
            </svg>
        """,
        unsafe_allow_html=True
    )

    # filter Rentang Waktu
    st.sidebar.header("Filter Rentang Waktu")
    min_date = hr_df['dteday'].min()
    max_date = hr_df['dteday'].max()

    start_date, end_date = st.sidebar.date_input(
        "Pilih Rentang Waktu", 
        [min_date, max_date], 
        min_value=min_date, 
        max_value=max_date
    )

# Filter Data dengan rentang waktu
filtered_df = hr_df[(hr_df['dteday'] >= pd.Timestamp(start_date)) & (hr_df['dteday'] <= pd.Timestamp(end_date))]

# Menampilkan Data
st.header("Data Hour Penyewaan Sepeda")
st.write(filtered_df.head())

# waktu tersibuk dalam sehari untuk penyewaan sepeda
st.header("Waktu Tersibuk dalam Sehari untuk Penyewaan Sepeda")

hourly_usage = filtered_df.groupby('hr')['cnt'].mean().reset_index()

hour_labels = {0: "12 AM", 1: "1 AM", 2: "2 AM", 3: "3 AM", 4: "4 AM", 5: "5 AM",
               6: "6 AM", 7: "7 AM", 8: "8 AM", 9: "9 AM", 10: "10 AM", 11: "11 AM",
               12: "12 PM", 13: "1 PM", 14: "2 PM", 15: "3 PM", 16: "4 PM", 17: "5 PM",
               18: "6 PM", 19: "7 PM", 20: "8 PM", 21: "9 PM", 22: "10 PM", 23: "11 PM"}

hourly_usage['hour_label'] = hourly_usage['hr'].map(hour_labels)

fig, ax = plt.subplots(figsize=(12, 6))
sns.lineplot(data=hourly_usage, x='hour_label', y='cnt', marker='o', color='b', ax=ax)
ax.set_title("Waktu Tersibuk dalam Sehari untuk Penyewaan Sepeda", fontsize=14)
ax.set_xlabel("Jam dalam Sehari", fontsize=12)
ax.set_ylabel("Jumlah Penyewaan", fontsize=12)
plt.xticks(rotation=45)
plt.grid(True)
st.pyplot(fig)

# Cuaca Mempengaruhi Jumlah Pengguna Sepeda
st.header("Pengaruh Kondisi Cuaca terhadap Penyewaan Sepeda")
weather_usage = filtered_df.groupby('weather_desc')['cnt'].mean().reset_index()
fig, ax = plt.subplots()
sns.barplot(x='weather_desc', y='cnt', data=weather_usage, ax=ax)
ax.set_xlabel("Kondisi Cuaca")
ax.set_ylabel("Rata-rata Penyewaan")
st.pyplot(fig)

# Jam Penyewaan Sepeda Paling Tinggi dan Paling Rendah
st.header("Jam Penyewaan Sepeda Paling Tinggi dan Paling Rendah")

hourly_usage = hr_df.groupby('hr')['cnt'].mean().reset_index()

hour_labels = {0: "12 AM", 1: "1 AM", 2: "2 AM", 3: "3 AM", 4: "4 AM", 5: "5 AM",
               6: "6 AM", 7: "7 AM", 8: "8 AM", 9: "9 AM", 10: "10 AM", 11: "11 AM",
               12: "12 PM", 13: "1 PM", 14: "2 PM", 15: "3 PM", 16: "4 PM", 17: "5 PM",
               18: "6 PM", 19: "7 PM", 20: "8 PM", 21: "9 PM", 22: "10 PM", 23: "11 PM"}

hourly_usage['hour_label'] = hourly_usage['hr'].map(hour_labels)

most_busy_hour = hourly_usage.loc[hourly_usage['cnt'].idxmax()]
least_busy_hour = hourly_usage.loc[hourly_usage['cnt'].idxmin()]

fig, ax = plt.subplots(figsize=(12, 6))

ax.bar(hourly_usage['hour_label'], hourly_usage['cnt'], color='blue', alpha=0.7, label="Rata-rata per jam")

ax.bar(most_busy_hour['hour_label'], most_busy_hour['cnt'], color='red', label="Tertinggi")

ax.bar(least_busy_hour['hour_label'], least_busy_hour['cnt'], color='orange', label="Terendah")

ax.set_title("Jumlah Penyewaan Sepeda per Jam", fontsize=14)
ax.set_xlabel("Jam dalam Sehari", fontsize=12)
ax.set_ylabel("Rata-rata Jumlah Penyewaan", fontsize=12)
ax.set_xticklabels(hourly_usage['hour_label'], rotation=45)
ax.legend()
ax.grid(True, linestyle='--', alpha=0.6)

st.pyplot(fig)

# Pola Penyewaan: Hari Kerja, Akhir Pekan, dan Hari Libur Nasional
st.header("Rata-rata Penyewaan Sepeda: weekday, Weekend, dan Holiday")

filtered_df['day_type'] = filtered_df['weekday'].apply(lambda x: 'Weekend' if x in [0, 6] else 'Weekday')
filtered_df.loc[filtered_df['holiday'] == 1, 'day_type'] = 'Holiday'

usage_by_day_type = filtered_df.groupby('day_type')['cnt'].mean().reset_index()
palette_colors = {'Weekday': 'blue', 'Weekend': 'red', 'Holiday': 'green'}

fig, ax = plt.subplots(figsize=(6, 4))
sns.barplot(x='day_type', y='cnt', data=usage_by_day_type, ax=ax, hue='day_type', palette=palette_colors, legend=False)

ax.set_xlabel("Jenis Hari", fontsize=12)
ax.set_ylabel("Rata-rata Penyewaan", fontsize=12)
ax.grid(True, linestyle='--', alpha=0.6)
legend_labels = [plt.Rectangle((0, 0), 1, 1, color=color) for color in palette_colors.values()]
ax.legend(legend_labels, palette_colors.keys(), title="Keterangan", loc="upper right")

st.pyplot(fig)

st.markdown(
    """
    <div style="text-align: center; margin-top: 50px;">
        <p>Â© 2025 CYCLO. All rights reserved.</p>
    </div>
    """,
    unsafe_allow_html=True
)